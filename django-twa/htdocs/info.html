{% extends "base.html" %}
{% load i18n %}

{% block content %}

<table>
  <tr>
    <th>{% trans "ID" %}</th>
    <th>{% trans "Username" %}</th>
    <th>{% trans "Name" %}</th>
    <th>{% trans "Last Login" %}</th>
    <th>{% trans "Active" %}</th>
    <th>{% trans "Admin" %}</th>
    <th>{% trans "Groups" %}</th>

    {% if user.is_superuser %}
    <th>{% trans "Superuser" %}</th>
    {% endif %}

  </tr>
  {% for benutzer in users %}
  <tr>
    <td>{{ benutzer.id }}</td>
    <td>
      {% if user.is_superuser %}
        <a class="edit" href="/admin/auth/user/{{ benutzer.id }}/">{{ benutzer.username }}</a>
      {% else %}
        {{ benutzer.username }}
      {% endif %}
    </td>
    <td>{{ benutzer.first_name }} {{ benutzer.last_name }}</td>
    <td>{{ benutzer.last_login }} <span class="meta small nobr">( {{ benutzer.last_login|timesince }} )</span></td>
    <td>{{ benutzer.is_active|yesno }}</td>
    <td>{{ benutzer.is_staff|yesno }}</td>
    <td>{% for group in benutzer.groups.all %}{{ group.name }} {% endfor %}</td>

    {% if user.is_superuser %}
    <td>{{ benutzer.is_superuser|yesno }}</td>
    {% endif %}

  </tr>
  {% endfor %}
  <tr>
    <td class="white" colspan="8">&nbsp;</td>
  </tr>
</table>

<table id="techinfo">
  <tr>
    <th colspan="2">{% trans "Technical Information" %}</th>
  </tr>
  <tr>
    <td>Server Time</td>
    <td>{% now "r" %}</td>
  </tr>
  <tr>
    <td>Server OS</td>
    <td>{{ os_version}}</td>
  </tr>
  <tr>
    <td>Django Version</td>
    <td>{{ django_version }}</td>
  </tr>
  <tr>
    <td>Python Version</td>
    <td>{{ python_version }}</td>
  </tr>
  <tr>
    <td>Database Version</td>
    <td>{{ mysql_version }}</td>
  </tr>
  <tr>
    <td>Source Code Repository</td>
    <td><a target="_blank" href="http://code.google.com/p/mti-twa/source/browse">Google Code</a></td>
  </tr>
  <tr>
    <td class="white" colspan="8">&nbsp;</td>
  </tr>
</table>


<table>
  <tr>
    <th>#</th>
    <th>{% trans "User Agents Top 10" %}</th>
    <th>{% trans "Page Hits" %}</th>
  </tr>
  {% for agent in agents|dictsortreversed:"count"|slice:"10" %}
  <tr>
    <td>{{ forloop.counter }}</td>
    <td>{{ agent.user_agent }}</td>
    <td style="text-align: right;">{{ agent.count|floatformat }}</td>
  </tr>
  {% endfor %}
  <tr>
    <td></td>
    <td>[all requests]</td>
    <td style="text-align: right;">{{ hits }}</td>
  </tr>
  <tr>
    <td class="white" colspan="8">&nbsp;</td>
  </tr>
</table>

{% if user.is_superuser %}

<p><a id="toggle_requests">Show/hide</a> last {{ requests|length }} requests.</p>

<table id="requests">
  <tr>
    <th>{% trans "ID" %}</th>
    <th>{% trans "Date" %}</th>
    <th>{% trans "User" %}</th>
    <th>{% trans "Path" %}</th>
    <th>{% trans "User Agent" %}</th>
    <th>{% trans "Remote" %}</th>
  </tr>
  {% for r in requests %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.created }}</td>
    <td>{{ r.user }}</td>
    <td><a href="{{ r.path }}">{{ r.path }}</a></td>
    <td>{{ r.user_agent }}</td>
    <td>{{ r.remote }}</td>
  </tr>
  {% endfor %}
  <tr>
    <td class="white" colspan="8">&nbsp;</td>
  </tr>
</table>

<p><a id="toggle_expired_sessions">Show/hide</a> all {{ expired_sessions|length }} expired sessions.</p>

<table id="expired_sessions">
  <tr>
    <th>#</th>
    <th>{% trans "Expired Session ID" %}</th>
    <th>{% trans "Is Expired" %}</th>
  </tr>
  {% for session in expired_sessions %}
  <tr>
    <td>{{ forloop.revcounter }}</td>
    <td>{{ session.pk }}</td>
    <td>{{ session.expire_date }} <span class="meta small nobr">( {{ session.expire_date|timesince }} )</span></td>
  </tr>
  {% endfor %}

  <tr>
    <td class="" colspan="3">
      {% if expired_sessions %}
      <form id="clean_up_session_form" action="." method="post">
        <input type="submit" id="clean_up_expired_sessions" name="clean_up_expired_sessions" value="Clean up" href="" /> will remove {{ expired_sessions|length }} expired sessions.
      </form>
      {% else %}
        {% trans "None" %}
      {% endif %}
    </td>
  </tr>
  <tr>
    <td class="white" colspan="8">&nbsp;</td>
  </tr>
</table>

<p><a id="toggle_active_sessions">Show/hide</a> all {{ active_sessions|length }} active sessions.</p>

<table id="active_sessions">
  <tr>
    <th>#</th>
    <th>{% trans "Active Session ID" %}</th>
    <th>{% trans "Will Expire" %}</th>
  </tr>
  {% for session in active_sessions %}
  <tr>
    <td>{{ forloop.revcounter }}</td>
    <td>{{ session.pk }}</td>
    <td>{{ session.expire_date }} <span class="meta small nobr">( {{ session.expire_date|timeuntil }} )</span></td>
  </tr>
  {% endfor %}
</table>

{% endif %} {# is_superuser #}

{% endblock %}
