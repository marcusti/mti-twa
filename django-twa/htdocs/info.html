{% extends "twa-index.html" %}
{% load i18n %}

{% block content %}

<p class="tx12g" align="center"><a class="edit" href="mailto:{% for benutzer in users %}{% if benutzer.is_active %}{{ benutzer.email }}{% if not forloop.last %};{% endif %}{% endif %}{% endfor %}">Email an alle</a></p>

<table class="tx12g">
  <tr>
    <th>{% trans "ID" %}</th>
    <th>{% trans "Name" %}</th>
    <th>{% trans "Last Login" %}</th>
    <th>{% trans "Active" %}</th>
    <th>{% trans "Admin" %}</th>
    <th>{% trans "Groups" %}</th>

    {% if user.is_superuser %}
    <th>{% trans "Superuser" %}</th>
    {% endif %}

  </tr>
  {% for benutzer in users %}
  {% if benutzer.is_active %}
  <tr>
    <td>
      {% if user.is_superuser %}
        <a class="edit" href="/admin/auth/user/{{ benutzer.id }}/">{{ benutzer.id }}</a>
      {% else %}
        {{ benutzer.id }}
      {% endif %}
    </td>
    <td>
      {{ benutzer.first_name }} {{ benutzer.last_name }} 
      {% if benutzer.email %}<br/><a href="mailto:{{ benutzer.email }}">{{ benutzer.email }}</a>{% endif %}
    </td>
    <td>{{ benutzer.last_login|date:"Y-m-d H:i" }}<br/>{{ benutzer.last_login|timesince }}</td>
    <td>{{ benutzer.is_active|yesno }}</td>
    <td>{{ benutzer.is_staff|yesno }}</td>
    <td>{% for group in benutzer.groups.all %}{{ group.name }} {% endfor %}</td>

    {% if user.is_superuser %}
    <td>{{ benutzer.is_superuser|yesno }}</td>
    {% endif %}

  </tr>
  {% endif %}
  {% endfor %}
</table>

<table class="tx12g">
  <tr class="">
    <th>{% trans "Last Changes" %} {% trans "Date" %}</th>
    <th>{% trans "User" %}</th>
    <th>{% trans "Object" %}</th>
    <th>{% trans "Change Message" %}</th>
  </tr>
  {% for log in logentries %}
  <tr>
    <td>{{ log.action_time|date:"D Y-m-d H:i:s" }}</td>
    <td>{{ log.user }}</td>
    <td>{{ log.content_type }} &raquo;<a href="/admin/{{ log.get_admin_url }}">{{ log.get_edited_object }}</a>&laquo;</td>
    <td>{{ log.change_message }}</td>
  </tr>
  {% endfor %}
</table>

<table class="tx12g">
  <tr>
    <th colspan="2">{% trans "Technical Information" %}</th>
  </tr>
  <tr>
    <td>Server Time</td>
    <td>{% now "r" %}</td>
  </tr>
  <tr>
    <td>Server OS</td>
    <td><a href="{{ os_link }}" target="_blank">{{ os_version}}</a></td>
  </tr>
  <tr>
    <td>Django Version</td>
    <td><a href="{{ django_link }}" target="_blank">{{ django_version }}</a></td>
  </tr>
  <tr>
    <td>Python Version</td>
    <td><a href="{{ python_link }}" target="_blank">{{ python_version }}</a></td>
  </tr>
  <tr>
    <td>Database Version</td>
    <td><a href="{{ db_link }}" target="_blank">{{ db_version }}</a></td>
  </tr>
  <tr>
    <td>Source Code Repository</td>
    <td><a target="_blank" href="http://code.google.com/p/mti-twa/source/browse">Google Code</a></td>
  </tr>
</table>


<table class="tx12g">
  <tr>
    <th>#</th>
    <th>{% trans "User Agents Top 10" %}</th>
    <th>{% trans "Hits" %}</th>
  </tr>
  {% for agent in agents|dictsortreversed:"count"|slice:"10" %}
  <tr>
    <td>{{ forloop.counter }}</td>
    <td>{{ agent.user_agent }}</td>
    <td style="text-align: right;">{{ agent.count|floatformat }}</td>
  </tr>
  {% endfor %}
  <tr>
    <td></td>
    <td>[all requests]</td>
    <td style="text-align: right;">{{ hits }}</td>
  </tr>
</table>

{% if user.is_superuser %}
<p>{{ expired_sessions|length }} expired sessions, {{ active_sessions|length }} active sessions.</p>
{% endif %} {# is_superuser #}

{% endblock %}
