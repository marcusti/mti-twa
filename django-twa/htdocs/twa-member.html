{% extends "twa-index.html" %}

{% load i18n %}
{% load twa_tags %}

{% block content %}

<div class="tx12g"  align="center">
  {% if perms.members.add_person %}<a href="/admin/members/person/add/" class="edit">{% trans "new" %}</a>{% endif %}
  {% if perms.members.add_person and perms.members.change_person %} | {% endif %}
  {% if perms.members.change_person %}<a href="/admin/members/person/{{ person.id }}" class="edit">{% trans "edit" %}</a>{% endif %}
</div>

{% if person.photo %}
  <img src="{{ person.photo.url }}"
       class="photo-margin"
       align="right"
       width="{{ person.photo.width }}"
       height="{{ person.photo.height }}"
       alt="[{{ person.firstname }} {{ person.lastname }}]"
       title="{{ person.firstname }} {{ person.lastname }}"
       />
{% else %}
{% endif %}

<ul class="">
  <li>
    <b>{{ person }}</b><br/>
    <ul><li>{{ person.current_rank }}</li></ul>
    <small>
    <ul>
    {% for dojo in dojos %}
      <li><a href="{{ dojo.get_absolute_url }}">{{ dojo.name }}</a></li>
    {% endfor %}
    </ul>
    </small>
  </li>

  {% if person.graduations.all %}
  <li>
    {% for grad in person.graduations.all %}
      {{ grad }}
      {% if grad.is_nomination %}
      <small>
        (
	{% if grad.nominated_by %}
          {% trans "Nominated By" %} {{ grad.nominated_by }}
        {% else %}
          {% trans "Nomination" %}
        {% endif %}
        )
      </small>
      {% endif %}
      <ul>
	{% if grad.date %}<li class="tx12g">{{ grad.date }} ({{ grad.date|timesince }})</li>{% endif %}
	{% if grad.text %}<li class="tx12g">{{ grad.text|linebreaksbr }}</li>{% endif %}
	{% if grad.request_doc %}<li class="tx12g"><a href="{{ grad.request_doc.url }}">{% trans "Request" %}</a> {{ grad.request_doc|extension|lower}}</li>{% endif %}
	{% if grad.confirmation_doc %}<li class="tx12g"><a href="{{ grad.confirmation_doc.url }}">{% trans "Confirmation" %}</a> {{ grad.confirmation_doc|extension|lower}}</li>{% endif %}
	{% if grad.payment_doc %}<li class="tx12g"><a href="{{ grad.payment_doc.url }}">{% trans "Payment" %}</a> {{ grad.payment_doc|extension|lower}}</li>{% endif %}
      </ul>
    {% endfor %}
  </li>
  {% endif %}

  {% if person.aikido_since %}
  <li class="tx12g">
    {% trans "Aikido" %}
    <ul><li>{{ person.aikido_since }} ({{ person.aikido_since|timesince }})</li></ul>
  </li>
  {% endif %}

  <li class="tx12g">
    {{ person.street }}<br/>
    {{ person.country.code }}-{{ person.zip }} {{ person.city }}<br/>
    {{ person.country.get_name }}<br/>
    {% if person.phone %}{{ person.phone }}<br/>{% endif %}
    {% if person.fax %}{{ person.fax }} ({% trans "Fax" %})<br/>{% endif %}
    {% if person.mobile %}{{ person.mobile }}<br/>{% endif %}
    {% if person.email %}<a href="mailto:{{ person.firstname }} {{ person.lastname }} <{{ person.email }}>">{{ person.email }}</a><br/>{% endif %}
    {% if person.website %}<a href="{{ person.website }}">{{ person.website }}</a><br/>{% endif %}
  </li>

  <li class="tx12g">
    {% trans "Age" %}: {{ person.age|default:"-" }}<br/>
    {% trans "Birth" %}: {{ person.birth|default:"-" }}<br/>
    {{ person.get_gender_display }}<br/>
  </li>

  {% if person.text %}
  <li class="tx12g">
    {{ person.text }}<br/>
  </li>
  {% endif %}

  <li class="tx12g">
    {% trans "TWA ID" %}:
    <ul>
    {% for membership in person.twamembership_set.all %}
      {% if membership.twa_id %}<li>{{ membership.twa_id }}</li>{% endif %}

      <li>
	{% if membership.date %}
	  {{ membership.date }} 
	{% else %}
  	  {{ membership.request }} 
	{% endif %}

	({{ membership.get_status_display }})
        {% if perms.members.change_twamembership %}<a href="/admin/members/twamembership/{{ membership.id }}" class="edit">{% trans "edit" %}</a>{% endif %}

	{% if membership.request_doc %}
	  <br/><a href="{{ membership.request_doc.url }}">{% trans "Request" %} ({{ membership.request_doc|extension|lower }})</a>
	{% endif %}
	
	{% if membership.text %}
	  <br/>{{ membership.text|linebreaksbr }}
	{% endif %}
      </li>

    {% if membership.twapayment_set %}
    <li><ul>
    {% for payment in membership.twapayment_set.all %}
      <li>
        {% trans "Payment" %} {{ payment.date }} {%if payment.cash %}({% trans "Cash" %}){% endif %}
        {% if payment.text %}<ul><li>{{ payment.text }}</li></ul>{% endif %}
      </li>
    {% endfor %}
    </ul></li>
    {% endif %}

    {% endfor %}
    </ul>
    
  </li>

  <li class="tx12g">
    {% trans "TWA License" %}:
    <ul>
    {% for license in person.license_set.all %}
      <li>
	{% if license.date %}
	  {{ license.date }} 
	{% else %}
  	  {{ license.request }} 
	{% endif %}

	({{ license.get_status_display }})
        {% if perms.members.change_license %}<a href="/admin/members/license/{{ license.id }}" class="edit">{% trans "edit" %}</a>{% endif %}

	{% if license.request_doc %}
	  <br/><a href="{{ license.request_doc.url }}">{% trans "Request" %} ({{ license.request_doc|extension|lower }})</a>
	{% endif %}
	{% if license.receipt_doc %}
	  <br/><a href="{{ license.receipt_doc.url }}">{% trans "Receipt" %} ({{ license.receipt_doc|extension|lower }})</a>
	{% endif %}
      </li>
    {% endfor %}
    </ul>
  </li>

  {% ifnotequal person.document_set.all.count 0 %}
  <li class="tx12g">
    {% trans "Documents" %}
    <ul>
    {% for document in person.document_set.all %}
      <li><a href="{{ document.file.url }}">{{ document.name }}</a></li>
    {% endfor %}
    </ul>
  </li>
  {% endifnotequal %}
</ul>

{% endblock %}
